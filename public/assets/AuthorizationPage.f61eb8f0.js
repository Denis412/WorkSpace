import{Q as h}from"./QPage.85506c96.js";import{a as m,Q as g}from"./QForm.21ad6556.js";import{_ as w,aI as I,aJ as v,r as b,m as d,n as p,p as _,v as i,q as l,x as S,aK as y,aL as x}from"./index.546e37fb.js";import{B as U,b as f,U as q,p as V,z as t,d as A}from"./queries.dad14669.js";import{U as Q,b as E}from"./stompClient.811952bd.js";import{s as k}from"./stomp.1f739222.js";A(E);const{mutate:z}=U(Q),{refetch:B}=f(q),{refetch:C}=f(V),F=async s=>{const{data:r,error:o}=await z({input:{login:s.email,password:s.password}});if(o)throw o;console.log(r.userSignIn.record.access_token),t.set("token",r.userSignIn.record.access_token);const{data:e,error:n}=await B({id:r.userSignIn.recordId});if(n)throw n;const{notificationSubscribe:a}=await k.queueCreate();return await C(),t.set("user_id",e.user.id),t.set("user_name",e.user.name),t.set("user_surname",e.user.surname),t.set("user_email",e.user.email),t.set("user_avatar",e.user.avatar),t.set("queue",a.hash),{user:e.user,queue:a.hash}},R={signIn:F};const N=s=>(y("data-v-fea16f38"),s=s(),x(),s),P=N(()=>i("header",{class:"text-center text-h6"},"\u0412\u0445\u043E\u0434",-1)),j={class:"q-mt-md"},T={__name:"AuthorizationForm",setup(s){const r=I(),o=v(),e=b({email:"",password:""}),n=async()=>{try{const a=await R.signIn(e.value);o.commit("user/SET_CURRENT_USER",a),r.push({name:"home"})}catch(a){console.log(a)}};return(a,u)=>(d(),p(g,{class:"flex column rounded-borders bg-grey-3 justify-between q-pa-md form-width",onSubmit:n},{default:_(()=>[P,i("main",null,[l(m,{modelValue:e.value.email,"onUpdate:modelValue":u[0]||(u[0]=c=>e.value.email=c),type:"email",label:"Email",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 email"},null,8,["modelValue"]),l(m,{modelValue:e.value.password,"onUpdate:modelValue":u[1]||(u[1]=c=>e.value.password=c),type:"password",label:"\u041F\u0430\u0440\u043E\u043B\u044C",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043F\u0430\u0440\u043E\u043B\u044C",class:"q-mt-sm"},null,8,["modelValue"])]),i("footer",null,[i("div",j,[l(S,{label:"\u0412\u043E\u0439\u0442\u0438",class:"bg-green w-100p",type:"submit"})])])]),_:1}))}};var J=w(T,[["__scopeId","data-v-fea16f38"]]);const H={__name:"AuthorizationPage",setup(s){return(r,o)=>(d(),p(h,{class:"flex q-pa-md justify-center items-center"},{default:_(()=>[l(J)]),_:1}))}};export{H as default};
